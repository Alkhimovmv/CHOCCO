(function() {   
    //horizontal accordeon

    const openItem = item => {
        const container = item.closest(".team__item");
        const contentBlock = container.find(".team__content");
        const textBlock = contentBlock.find(".team__content-block");
        const reqHeight = textBlock.height();

        container.addClass("active");
        contentBlock.height(reqHeight);
    }

    const closeEveryItem = container => {
        const items = container.find('.team__content');
        const itemContainer = container.find(".team__item");

        itemContainer.removeClass("active");
        items.height(0);
    }

    $('.team__title').click( e => {
        const $this = $(e.currentTarget);
        const container = $this.closest(".team");
        const elemContainer = $this.closest(".team__item");

        if (elemContainer.hasClass("active")) {
            closeEveryItem(container);
        } else {
            closeEveryItem(container);
            openItem($this); 
        }
    });

    // verticalAcco();

    const isMobile = window.matchMedia("(max-width: 480px)").matches;

    const calculateWidth = (item) => {
        let reqItemWidth = 0;

        const screenWidth = $(window).width();
        const container = item.closest(".menu-acco");
        const titlesBlocks = container.find(".menu-acco__trigger");
        const titlesWidth = titlesBlocks.width() * titlesBlocks.length;
        const maxWidth = 524;

        const textContainer = item.find(".menu-acco__container");

        const isTablets = window.matchMedia("(max-width: 768px)").matches;

        const isMobile = window.matchMedia("(max-width: 480px)").matches;

        if (isMobile) {
            reqItemWidth = screenWidth;
        } else if (isTablets) {
            reqItemWidth = screenWidth - titlesWidth;
        } else {
            reqItemWidth = maxWidth;
        }

        return {
            container: reqItemWidth,
            textContainer: reqItemWidth
        }
    };

    const openItemAcco = (item) => {
        const hiddenContent = item.find(".menu-acco__content");
        const reqWidth = calculateWidth(item);
        const textBlock = item.find(".menu-acco__container");

        item.addClass("active");
        hiddenContent.width(reqWidth.container);
        textBlock.width(reqWidth.textContainer);
    };

    const closeEveryItemInContainer = (container) => {
        const items = container.find(".menu-acco__item");
        const content = container.find(".menu-acco__content");

        items.removeClass("active");
        content.width(0);
    };

    const isMobileAcco = window.matchMedia("(max-width: 480px)").matches;

    if(isMobileAcco){
        $(".menu-acco--trigger .menu-acco__trigger").on("click", e => {
            e.preventDefault();
    
            const $this = $(e.currentTarget);
            const item = $this.closest(".menu-acco__item");
            const itemNdx = item.index();
    
            const itemToOpen = $(".menu-acco--content .menu-acco__item").eq(itemNdx);
    
            item.addClass("hidden");
            openItemAcco(itemToOpen);
        });

        $(".menu-acco--content .menu-acco__trigger").on("click", e => {
            e.preventDefault();
    
            $(".menu-acco--trigger .menu-acco__item").removeClass("hidden");
            closeEveryItemInContainer($(".menu-acco--content"));
        });
    } else {
        $(".menu-acco__trigger").on("click", e => {
            e.preventDefault();
    
            const $this = $(e.currentTarget);
            const item = $this.closest(".menu-acco__item");
            const itemOpened = item.hasClass("active");
            const container = $this.closest(".menu-acco");
    
            if(itemOpened) {
                closeEveryItemInContainer(container);
            } else {
                closeEveryItemInContainer(container);
                openItemAcco(item);
            }
        });
    }
 
})() ;(function() {      
   const btn = document.getElementById('hamburger');

   btn.addEventListener('click', ()=>{
      const modal = document.getElementById('menu');
      modal.classList.add('modal_active');
   });



   const close = document.getElementById('modal__close');

   close.addEventListener('click', ()=>{
      const modal = document.getElementById('menu');
      modal.classList.remove('modal_active');
   });

   const closeModal = document.querySelectorAll('.modal-menu__link');

   closeModal.forEach((item) => {
      item.addEventListener('click', ()=>{
         const modal = document.getElementById('menu');
         modal.classList.remove('modal_active');
      });
   })

   /////////////////////////////////////////////////

   const phone = document.querySelector('#phone');

   phone.addEventListener('keydown', function(event) {
      let isDigit = false;
      let isDash = false;
      let isControl = false;

      if (event.key >= 0 || event.key <= 9) {
         isDigit = true;
      }

      if (event.key == '-') {
         isDash = true;
      }

      if (event.key == 'ArrowLeft'  || event.key == 'ArrowRight'  || event.key == 'Backspace') {
         isControl = true;
      }

      if (!isDigit && !isDash && !isControl) {
         event.preventDefault();
      }
   });



   ///////////////////////
   function validateForm(form) {
      let valid = true;

      if (!validateField(form.elements.name)) {
         valid = false;
      }

      if (!validateField(form.elements.phone)) {
         valid = false;
      }

      if (!validateField(form.elements.comment)) {
         valid = false;
      }

      return valid;
   }

   function validateField(field) {
      field.nextElementSibling.textContent = field.validationMessage;
      return field.checkValidity();
   }
})() ;(function() {       
    let myMap;

    const init = () => {
        myMap = new ymaps.Map("map", {
            center: [55.75, 37.60],
            zoom: 14,
            controls: []
        });

        const coords = [
            [55.743455, 37.583656],
            [55.755799, 37.584804],
            [55.747812, 37.606940],
            [55.755103, 37.625051],
        ];

        const myCollection = new ymaps.GeoObjectCollection({}, {
            draggable: false,
            iconLayout: 'default#image',
            iconImageHref: './img/icons/marker.png',
            iconImageSize: [58, 73],
            iconImageOffset: [-3, -42]
        });

        coords.forEach(coord => {
            myCollection.add(new ymaps.Placemark(coord));
        });

        myMap.geoObjects.add(myCollection);

        myMap.behaviors.disable('scrollZoom');
    }

    ymaps.ready(init);
})() ;(function() {       
    const validateFields = (form, fieldsArray) => {
        fieldsArray.forEach((field) => {
            field.removeClass("input-error");
            if (field.val().trim() == "") {
                field.addClass("input-error");
            }
        });

        const errorFields = form.find(".input-error");

        return errorFields.length == 0;
    }

    $(".form").submit(e => {
        e.preventDefault();

        const form = $(e.currentTarget);
        const name = form.find("[name='name']");  
        const phone = form.find("[name='phone']"); 
        const comment = form.find("[name='comment']"); 
        const to = form.find("[name='to']"); 

        const isValid = validateFields(form, [name, phone, comment, to])

        const modalForm = $("#modal-form");
        const content = modalForm.find(".modal-form__content");

        modalForm.removeClass("error-modal");

        if(isValid) {
            const request = $.ajax({
                url: "https://webdev-api.loftschool.com/sendmail",
                method: "post",
                data: {
                    name: name.val(),
                    phone: phone.val(),
                    comment: comment.val(),
                    to: to.val(),
                },
            });
        
            request.done(data => {
                content.text(data.message);
            });
        
            request.fail(data => {
                const message = data.responseJSON.message;
                content.text(message);
                modalForm.addClass("error-modal");
            });
        
            request.always(() => {
                $.fancybox.open({
                    src: "#modal-form",
                    type: "inline",
                });
            });
        }

    });


    $(".app-close-modal").click(e => {
        e.preventDefault();

        $.fancybox.close();
        form.reset();
    })
})() 
 ;(function() {       
    const sections = $("section");
    const display = $(".maincontent");
    const sideMenu = $(".fixed-menu");
    const menuItems = sideMenu.find(".fixed-menu__item");

    const mobileDetect = new MobileDetect(window.navigator.userAgent);
    const isMobile = mobileDetect.mobile();

    let inScroll = false;

    sections.first().addClass("active");

    const countSectionPosition = sectionEq => {
        const position = sectionEq * -100;

        if (isNaN(position)) {
            console.error("передано не верное значение в countSectionPosition");
            return 0;

        }
        return position;
    }

    const changeMenuThemeForSection = sectionEq => {
        const currentSection = sections.eq(sectionEq);
        const menuTheme = currentSection.attr("data-sidemenu-theme");
        const activeClass = "fixed-menu--shadowed";

        if (menuTheme == "black"){
            sideMenu.addClass(activeClass);
        } else {
            sideMenu.removeClass(activeClass);
        }
    };

    const resetActiveClassForItem = (items, itemEq, activeClass) => {
        items.eq(itemEq).addClass(activeClass).siblings().removeClass(activeClass);
    }

    const performTransition = sectionEq => {
        if(inScroll) return;

        const transitionOver = 1000;
        const mouseInertiaOver = 300;

        inScroll = true;

        const position = countSectionPosition(sectionEq);

        changeMenuThemeForSection(sectionEq);

        display.css({
            transform: `translateY(${position}%)`
        });

        resetActiveClassForItem(sections, sectionEq, "active");

        setTimeout(() => {
            inScroll = false;
            resetActiveClassForItem(menuItems, sectionEq, "fixed-menu__item--active");
        }, transitionOver + mouseInertiaOver);
    };

    const viewportScroller = () => {
        const activeSection = sections.filter(".active");
        const nextSection = activeSection.next();
        const prevSection = activeSection.prev();

        return {
            next() {
                if (nextSection.length){
                    performTransition(nextSection.index())
                }
            },
            prev() {
                if (prevSection.length){
                    performTransition(prevSection.index())
                }
            },
        };
    };

    $(window).on("wheel", e => {
        const deltaY = e.originalEvent.deltaY;
        const scroller = viewportScroller();

        if (deltaY > 0) {
            scroller.next();
        }

        if (deltaY < 0) {
            scroller.prev();
        }

    });

    $(window).on("keydown", e => {
        const tagName = e.target.tagName.toLowerCase();
        const userTypingInInputs = tagName == "input" || tagName == "textarea";
        const scroller = viewportScroller();

        if (userTypingInInputs) return;

        switch (e.keyCode) {
            case 38: 
                scroller.prev();
                break;
        
            case 40: 
                scroller.next();
                break;
        }
    });

    $(".wrapper").on("touchmove", e => e.preventDefault());

    $("[data-scroll-to").click(e => {
        e.preventDefault();

        const $this = $(e.currentTarget);
        const target = $this.attr("data-scroll-to");
        const reqSection = $(`[data-section-id=${target}]`);

        performTransition(reqSection.index());
    });

    if (isMobile) {
        // https://github.com/mattbryson/TouchSwipe-Jquery-Plugin

        $("body").swipe( {
            swipe: function(event, direction) {
                const scroller = viewportScroller();
                let scrollDirection = "";

                if (direction == "up") scrollDirection = "next";
                if (direction == "down") scrollDirection = "prev";

                scroller[scrollDirection]();
            }
        });
    }
})() ;  
    let player;
    const playerContainer = $('.player');

    let eventsInit = () => {
        $(".player__start").click( e => {
            e.preventDefault();
            
            if (playerContainer.hasClass('paused')) {
                player.pauseVideo()
            } else {
                player.playVideo();
            }        
        });

        $(".player__playback").click(e => {
            const bar = $(e.currentTarget);
            const clickedPosition = (e.originalEvent.layerX);
            console.log(clickedPosition);
            const newButtonPositionPercent = (clickedPosition / bar.width()) * 100;
            const newPlaybackPositionSec = (player.getDuration() / 100) * newButtonPositionPercent;

            $(".player__playback-button").css({
                left: `${newButtonPositionPercent}%`
            });

            player.seekTo(newPlaybackPositionSec);

        });

        $(".player__splash").click(e => {
            player.playVideo();
        });
    };

    const formatTime = timeSec => {
        const round = Math.round(timeSec);

        const minutes = Math.floor(roundTime / 60);
        const seconds = roundTime - minutes * 60;

        return `${minutes} : ${seconds}`; 
    }

    const onPlayerReady = () => {
        let interval;
        const durationSec = player.getDuration();

        if (typeof interval != "undefined") {
            clearInterval(interval);
        }

        interval = setInterval(() => {
            const completedSec = player.getCurrentTime();
            const completedPercent = (completedSec / durationSec) * 100;

            $(".player__playback-button").css({
                left: `${completedPercent}%`
            })
        }, 1000)

    }

    const onPlayerStateChange = event => {
        /* 
            -1 – воспроизведение видео не началось
            0 – воспроизведение видео завершено
            1 – воспроизведение
            2 – пауза
            3 – буферизация
            5 – видео находится в очереди
        */
        switch (event.data) {
            case 1:
                playerContainer.addClass('active');
                playerContainer.addClass("paused");
                $('#play').css("display", "none");
                $('#pause').css("display", "block");
                break;

            case 2:
                playerContainer.removeClass('active');
                playerContainer.removeClass("paused");
                $('#pause').css("display", "none");
                $('#play').css("display", "block");
                break;
        }
    };

    let dimensions = {
        height: "390",
        width: "660"
    };

    const isTablets = window.matchMedia("(max-width: 768px)").matches;
    const isMobile = window.matchMedia("(max-width: 480px)").matches;
    
    if(isTablets) {
        dimensions = {
            height: "351",
            width: "594"
        }
    } 
    
    if(isMobile) {
        dimensions = {
            height: "233",
            width: "394"
        }
    }

    function onYouTubeIframeAPIReady() {
        player = new YT.Player('yt-player', {
            ...dimensions,
            videoId: 'LXb3EKWsInQ',
            events: {
                'onReady': onPlayerReady,
                'onStateChange': onPlayerStateChange
            },
            playerVars: {
                controls: 0,
                disablekb: 0,
                showInfo: 0,
                rel: 0,
                autoplay: 0,
                modestbranding: 0,
            }
        });
    }

    eventsInit();
        
    let soundControl;
    let soundLevel;

    $().ready(function () {
        initVars();
        soundControl.min = 0;
        soundControl.max = 100;
        soundControl.value = soundControl.max;
    });

    // инициализация перменных
    function initVars() {
        player = document.getElementById('yt-player');
        soundControl = document.getElementById('micLevel');
    }

    $('#mic').on('click', function() {      
        if(player.isMuted()){
            soundControl.value = soundLevel * 100;
            player.unMute();
        }
        
        else{
            soundControl.value = 0;
            player.mute();
        }    
    });

    $('#micLevel').on('change', function () {
        player.setVolume($(this).val());
    });
            ;$('.slider__list').bxSlider({
        
});
;(function() {       
    const findBlockByAlias = (alias) => {
        return $(".reviews__item").filter((ndx, item) => {
            return $(item).attr("data-linked-with") == alias;
        });
    };

    $(".interactive-avatar__link").click((e) => {
        e.preventDefault();

        const $this = $(e.currentTarget);
        const target = $this.attr("data-open");
        const itemToShow = findBlockByAlias(target);
        const curItem = $this.closest(".interactive-avatar");

        itemToShow.addClass("active").siblings().removeClass("active");
        curItem.addClass("active").siblings().removeClass("active");
    });
})() 
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjY29yZGVvbi5qcyIsImluZGV4LmpzIiwibWFwLmpzIiwibW9kYWwtZm9ybS5qcyIsIm9wcy5qcyIsInBsYXllci5qcyIsInNsaWRlci5qcyIsInRhYnMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1DN0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQzdFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUNuQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQ3RFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1DOUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUNuS0E7QUFDQTtBQUNBO0FBQ0EsQ0NIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJtYWluLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpIHsgICBcclxuICAgIC8vaG9yaXpvbnRhbCBhY2NvcmRlb25cclxuXHJcbiAgICBjb25zdCBvcGVuSXRlbSA9IGl0ZW0gPT4ge1xyXG4gICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGl0ZW0uY2xvc2VzdChcIi50ZWFtX19pdGVtXCIpO1xyXG4gICAgICAgIGNvbnN0IGNvbnRlbnRCbG9jayA9IGNvbnRhaW5lci5maW5kKFwiLnRlYW1fX2NvbnRlbnRcIik7XHJcbiAgICAgICAgY29uc3QgdGV4dEJsb2NrID0gY29udGVudEJsb2NrLmZpbmQoXCIudGVhbV9fY29udGVudC1ibG9ja1wiKTtcclxuICAgICAgICBjb25zdCByZXFIZWlnaHQgPSB0ZXh0QmxvY2suaGVpZ2h0KCk7XHJcblxyXG4gICAgICAgIGNvbnRhaW5lci5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcclxuICAgICAgICBjb250ZW50QmxvY2suaGVpZ2h0KHJlcUhlaWdodCk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgY2xvc2VFdmVyeUl0ZW0gPSBjb250YWluZXIgPT4ge1xyXG4gICAgICAgIGNvbnN0IGl0ZW1zID0gY29udGFpbmVyLmZpbmQoJy50ZWFtX19jb250ZW50Jyk7XHJcbiAgICAgICAgY29uc3QgaXRlbUNvbnRhaW5lciA9IGNvbnRhaW5lci5maW5kKFwiLnRlYW1fX2l0ZW1cIik7XHJcblxyXG4gICAgICAgIGl0ZW1Db250YWluZXIucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XHJcbiAgICAgICAgaXRlbXMuaGVpZ2h0KDApO1xyXG4gICAgfVxyXG5cclxuICAgICQoJy50ZWFtX190aXRsZScpLmNsaWNrKCBlID0+IHtcclxuICAgICAgICBjb25zdCAkdGhpcyA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuICAgICAgICBjb25zdCBjb250YWluZXIgPSAkdGhpcy5jbG9zZXN0KFwiLnRlYW1cIik7XHJcbiAgICAgICAgY29uc3QgZWxlbUNvbnRhaW5lciA9ICR0aGlzLmNsb3Nlc3QoXCIudGVhbV9faXRlbVwiKTtcclxuXHJcbiAgICAgICAgaWYgKGVsZW1Db250YWluZXIuaGFzQ2xhc3MoXCJhY3RpdmVcIikpIHtcclxuICAgICAgICAgICAgY2xvc2VFdmVyeUl0ZW0oY29udGFpbmVyKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjbG9zZUV2ZXJ5SXRlbShjb250YWluZXIpO1xyXG4gICAgICAgICAgICBvcGVuSXRlbSgkdGhpcyk7IFxyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIC8vIHZlcnRpY2FsQWNjbygpO1xyXG5cclxuICAgIGNvbnN0IGlzTW9iaWxlID0gd2luZG93Lm1hdGNoTWVkaWEoXCIobWF4LXdpZHRoOiA0ODBweClcIikubWF0Y2hlcztcclxuXHJcbiAgICBjb25zdCBjYWxjdWxhdGVXaWR0aCA9IChpdGVtKSA9PiB7XHJcbiAgICAgICAgbGV0IHJlcUl0ZW1XaWR0aCA9IDA7XHJcblxyXG4gICAgICAgIGNvbnN0IHNjcmVlbldpZHRoID0gJCh3aW5kb3cpLndpZHRoKCk7XHJcbiAgICAgICAgY29uc3QgY29udGFpbmVyID0gaXRlbS5jbG9zZXN0KFwiLm1lbnUtYWNjb1wiKTtcclxuICAgICAgICBjb25zdCB0aXRsZXNCbG9ja3MgPSBjb250YWluZXIuZmluZChcIi5tZW51LWFjY29fX3RyaWdnZXJcIik7XHJcbiAgICAgICAgY29uc3QgdGl0bGVzV2lkdGggPSB0aXRsZXNCbG9ja3Mud2lkdGgoKSAqIHRpdGxlc0Jsb2Nrcy5sZW5ndGg7XHJcbiAgICAgICAgY29uc3QgbWF4V2lkdGggPSA1MjQ7XHJcblxyXG4gICAgICAgIGNvbnN0IHRleHRDb250YWluZXIgPSBpdGVtLmZpbmQoXCIubWVudS1hY2NvX19jb250YWluZXJcIik7XHJcblxyXG4gICAgICAgIGNvbnN0IGlzVGFibGV0cyA9IHdpbmRvdy5tYXRjaE1lZGlhKFwiKG1heC13aWR0aDogNzY4cHgpXCIpLm1hdGNoZXM7XHJcblxyXG4gICAgICAgIGNvbnN0IGlzTW9iaWxlID0gd2luZG93Lm1hdGNoTWVkaWEoXCIobWF4LXdpZHRoOiA0ODBweClcIikubWF0Y2hlcztcclxuXHJcbiAgICAgICAgaWYgKGlzTW9iaWxlKSB7XHJcbiAgICAgICAgICAgIHJlcUl0ZW1XaWR0aCA9IHNjcmVlbldpZHRoO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoaXNUYWJsZXRzKSB7XHJcbiAgICAgICAgICAgIHJlcUl0ZW1XaWR0aCA9IHNjcmVlbldpZHRoIC0gdGl0bGVzV2lkdGg7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmVxSXRlbVdpZHRoID0gbWF4V2lkdGg7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBjb250YWluZXI6IHJlcUl0ZW1XaWR0aCxcclxuICAgICAgICAgICAgdGV4dENvbnRhaW5lcjogcmVxSXRlbVdpZHRoXHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCBvcGVuSXRlbUFjY28gPSAoaXRlbSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGhpZGRlbkNvbnRlbnQgPSBpdGVtLmZpbmQoXCIubWVudS1hY2NvX19jb250ZW50XCIpO1xyXG4gICAgICAgIGNvbnN0IHJlcVdpZHRoID0gY2FsY3VsYXRlV2lkdGgoaXRlbSk7XHJcbiAgICAgICAgY29uc3QgdGV4dEJsb2NrID0gaXRlbS5maW5kKFwiLm1lbnUtYWNjb19fY29udGFpbmVyXCIpO1xyXG5cclxuICAgICAgICBpdGVtLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xyXG4gICAgICAgIGhpZGRlbkNvbnRlbnQud2lkdGgocmVxV2lkdGguY29udGFpbmVyKTtcclxuICAgICAgICB0ZXh0QmxvY2sud2lkdGgocmVxV2lkdGgudGV4dENvbnRhaW5lcik7XHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IGNsb3NlRXZlcnlJdGVtSW5Db250YWluZXIgPSAoY29udGFpbmVyKSA9PiB7XHJcbiAgICAgICAgY29uc3QgaXRlbXMgPSBjb250YWluZXIuZmluZChcIi5tZW51LWFjY29fX2l0ZW1cIik7XHJcbiAgICAgICAgY29uc3QgY29udGVudCA9IGNvbnRhaW5lci5maW5kKFwiLm1lbnUtYWNjb19fY29udGVudFwiKTtcclxuXHJcbiAgICAgICAgaXRlbXMucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XHJcbiAgICAgICAgY29udGVudC53aWR0aCgwKTtcclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgaXNNb2JpbGVBY2NvID0gd2luZG93Lm1hdGNoTWVkaWEoXCIobWF4LXdpZHRoOiA0ODBweClcIikubWF0Y2hlcztcclxuXHJcbiAgICBpZihpc01vYmlsZUFjY28pe1xyXG4gICAgICAgICQoXCIubWVudS1hY2NvLS10cmlnZ2VyIC5tZW51LWFjY29fX3RyaWdnZXJcIikub24oXCJjbGlja1wiLCBlID0+IHtcclxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgXHJcbiAgICAgICAgICAgIGNvbnN0ICR0aGlzID0gJChlLmN1cnJlbnRUYXJnZXQpO1xyXG4gICAgICAgICAgICBjb25zdCBpdGVtID0gJHRoaXMuY2xvc2VzdChcIi5tZW51LWFjY29fX2l0ZW1cIik7XHJcbiAgICAgICAgICAgIGNvbnN0IGl0ZW1OZHggPSBpdGVtLmluZGV4KCk7XHJcbiAgICBcclxuICAgICAgICAgICAgY29uc3QgaXRlbVRvT3BlbiA9ICQoXCIubWVudS1hY2NvLS1jb250ZW50IC5tZW51LWFjY29fX2l0ZW1cIikuZXEoaXRlbU5keCk7XHJcbiAgICBcclxuICAgICAgICAgICAgaXRlbS5hZGRDbGFzcyhcImhpZGRlblwiKTtcclxuICAgICAgICAgICAgb3Blbkl0ZW1BY2NvKGl0ZW1Ub09wZW4pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAkKFwiLm1lbnUtYWNjby0tY29udGVudCAubWVudS1hY2NvX190cmlnZ2VyXCIpLm9uKFwiY2xpY2tcIiwgZSA9PiB7XHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgIFxyXG4gICAgICAgICAgICAkKFwiLm1lbnUtYWNjby0tdHJpZ2dlciAubWVudS1hY2NvX19pdGVtXCIpLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xyXG4gICAgICAgICAgICBjbG9zZUV2ZXJ5SXRlbUluQ29udGFpbmVyKCQoXCIubWVudS1hY2NvLS1jb250ZW50XCIpKTtcclxuICAgICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgJChcIi5tZW51LWFjY29fX3RyaWdnZXJcIikub24oXCJjbGlja1wiLCBlID0+IHtcclxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgXHJcbiAgICAgICAgICAgIGNvbnN0ICR0aGlzID0gJChlLmN1cnJlbnRUYXJnZXQpO1xyXG4gICAgICAgICAgICBjb25zdCBpdGVtID0gJHRoaXMuY2xvc2VzdChcIi5tZW51LWFjY29fX2l0ZW1cIik7XHJcbiAgICAgICAgICAgIGNvbnN0IGl0ZW1PcGVuZWQgPSBpdGVtLmhhc0NsYXNzKFwiYWN0aXZlXCIpO1xyXG4gICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSAkdGhpcy5jbG9zZXN0KFwiLm1lbnUtYWNjb1wiKTtcclxuICAgIFxyXG4gICAgICAgICAgICBpZihpdGVtT3BlbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBjbG9zZUV2ZXJ5SXRlbUluQ29udGFpbmVyKGNvbnRhaW5lcik7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjbG9zZUV2ZXJ5SXRlbUluQ29udGFpbmVyKGNvbnRhaW5lcik7XHJcbiAgICAgICAgICAgICAgICBvcGVuSXRlbUFjY28oaXRlbSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuIFxyXG59KSgpICIsIihmdW5jdGlvbigpIHsgICAgICBcclxuICAgY29uc3QgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hhbWJ1cmdlcicpO1xyXG5cclxuICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCk9PntcclxuICAgICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWVudScpO1xyXG4gICAgICBtb2RhbC5jbGFzc0xpc3QuYWRkKCdtb2RhbF9hY3RpdmUnKTtcclxuICAgfSk7XHJcblxyXG5cclxuXHJcbiAgIGNvbnN0IGNsb3NlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vZGFsX19jbG9zZScpO1xyXG5cclxuICAgY2xvc2UuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKT0+e1xyXG4gICAgICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZW51Jyk7XHJcbiAgICAgIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ21vZGFsX2FjdGl2ZScpO1xyXG4gICB9KTtcclxuXHJcbiAgIGNvbnN0IGNsb3NlTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubW9kYWwtbWVudV9fbGluaycpO1xyXG5cclxuICAgY2xvc2VNb2RhbC5mb3JFYWNoKChpdGVtKSA9PiB7XHJcbiAgICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKT0+e1xyXG4gICAgICAgICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZW51Jyk7XHJcbiAgICAgICAgIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ21vZGFsX2FjdGl2ZScpO1xyXG4gICAgICB9KTtcclxuICAgfSlcclxuXHJcbiAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcbiAgIGNvbnN0IHBob25lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3Bob25lJyk7XHJcblxyXG4gICBwaG9uZS5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgZnVuY3Rpb24oZXZlbnQpIHtcclxuICAgICAgbGV0IGlzRGlnaXQgPSBmYWxzZTtcclxuICAgICAgbGV0IGlzRGFzaCA9IGZhbHNlO1xyXG4gICAgICBsZXQgaXNDb250cm9sID0gZmFsc2U7XHJcblxyXG4gICAgICBpZiAoZXZlbnQua2V5ID49IDAgfHwgZXZlbnQua2V5IDw9IDkpIHtcclxuICAgICAgICAgaXNEaWdpdCA9IHRydWU7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChldmVudC5rZXkgPT0gJy0nKSB7XHJcbiAgICAgICAgIGlzRGFzaCA9IHRydWU7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChldmVudC5rZXkgPT0gJ0Fycm93TGVmdCcgIHx8IGV2ZW50LmtleSA9PSAnQXJyb3dSaWdodCcgIHx8IGV2ZW50LmtleSA9PSAnQmFja3NwYWNlJykge1xyXG4gICAgICAgICBpc0NvbnRyb2wgPSB0cnVlO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoIWlzRGlnaXQgJiYgIWlzRGFzaCAmJiAhaXNDb250cm9sKSB7XHJcbiAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgIH1cclxuICAgfSk7XHJcblxyXG5cclxuXHJcbiAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcbiAgIGZ1bmN0aW9uIHZhbGlkYXRlRm9ybShmb3JtKSB7XHJcbiAgICAgIGxldCB2YWxpZCA9IHRydWU7XHJcblxyXG4gICAgICBpZiAoIXZhbGlkYXRlRmllbGQoZm9ybS5lbGVtZW50cy5uYW1lKSkge1xyXG4gICAgICAgICB2YWxpZCA9IGZhbHNlO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoIXZhbGlkYXRlRmllbGQoZm9ybS5lbGVtZW50cy5waG9uZSkpIHtcclxuICAgICAgICAgdmFsaWQgPSBmYWxzZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKCF2YWxpZGF0ZUZpZWxkKGZvcm0uZWxlbWVudHMuY29tbWVudCkpIHtcclxuICAgICAgICAgdmFsaWQgPSBmYWxzZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIHZhbGlkO1xyXG4gICB9XHJcblxyXG4gICBmdW5jdGlvbiB2YWxpZGF0ZUZpZWxkKGZpZWxkKSB7XHJcbiAgICAgIGZpZWxkLm5leHRFbGVtZW50U2libGluZy50ZXh0Q29udGVudCA9IGZpZWxkLnZhbGlkYXRpb25NZXNzYWdlO1xyXG4gICAgICByZXR1cm4gZmllbGQuY2hlY2tWYWxpZGl0eSgpO1xyXG4gICB9XHJcbn0pKCkgIiwiKGZ1bmN0aW9uKCkgeyAgICAgICBcclxuICAgIGxldCBteU1hcDtcclxuXHJcbiAgICBjb25zdCBpbml0ID0gKCkgPT4ge1xyXG4gICAgICAgIG15TWFwID0gbmV3IHltYXBzLk1hcChcIm1hcFwiLCB7XHJcbiAgICAgICAgICAgIGNlbnRlcjogWzU1Ljc1LCAzNy42MF0sXHJcbiAgICAgICAgICAgIHpvb206IDE0LFxyXG4gICAgICAgICAgICBjb250cm9sczogW11cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgY29uc3QgY29vcmRzID0gW1xyXG4gICAgICAgICAgICBbNTUuNzQzNDU1LCAzNy41ODM2NTZdLFxyXG4gICAgICAgICAgICBbNTUuNzU1Nzk5LCAzNy41ODQ4MDRdLFxyXG4gICAgICAgICAgICBbNTUuNzQ3ODEyLCAzNy42MDY5NDBdLFxyXG4gICAgICAgICAgICBbNTUuNzU1MTAzLCAzNy42MjUwNTFdLFxyXG4gICAgICAgIF07XHJcblxyXG4gICAgICAgIGNvbnN0IG15Q29sbGVjdGlvbiA9IG5ldyB5bWFwcy5HZW9PYmplY3RDb2xsZWN0aW9uKHt9LCB7XHJcbiAgICAgICAgICAgIGRyYWdnYWJsZTogZmFsc2UsXHJcbiAgICAgICAgICAgIGljb25MYXlvdXQ6ICdkZWZhdWx0I2ltYWdlJyxcclxuICAgICAgICAgICAgaWNvbkltYWdlSHJlZjogJy4vaW1nL2ljb25zL21hcmtlci5wbmcnLFxyXG4gICAgICAgICAgICBpY29uSW1hZ2VTaXplOiBbNTgsIDczXSxcclxuICAgICAgICAgICAgaWNvbkltYWdlT2Zmc2V0OiBbLTMsIC00Ml1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgY29vcmRzLmZvckVhY2goY29vcmQgPT4ge1xyXG4gICAgICAgICAgICBteUNvbGxlY3Rpb24uYWRkKG5ldyB5bWFwcy5QbGFjZW1hcmsoY29vcmQpKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgbXlNYXAuZ2VvT2JqZWN0cy5hZGQobXlDb2xsZWN0aW9uKTtcclxuXHJcbiAgICAgICAgbXlNYXAuYmVoYXZpb3JzLmRpc2FibGUoJ3Njcm9sbFpvb20nKTtcclxuICAgIH1cclxuXHJcbiAgICB5bWFwcy5yZWFkeShpbml0KTtcclxufSkoKSAiLCIoZnVuY3Rpb24oKSB7ICAgICAgIFxyXG4gICAgY29uc3QgdmFsaWRhdGVGaWVsZHMgPSAoZm9ybSwgZmllbGRzQXJyYXkpID0+IHtcclxuICAgICAgICBmaWVsZHNBcnJheS5mb3JFYWNoKChmaWVsZCkgPT4ge1xyXG4gICAgICAgICAgICBmaWVsZC5yZW1vdmVDbGFzcyhcImlucHV0LWVycm9yXCIpO1xyXG4gICAgICAgICAgICBpZiAoZmllbGQudmFsKCkudHJpbSgpID09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgIGZpZWxkLmFkZENsYXNzKFwiaW5wdXQtZXJyb3JcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgY29uc3QgZXJyb3JGaWVsZHMgPSBmb3JtLmZpbmQoXCIuaW5wdXQtZXJyb3JcIik7XHJcblxyXG4gICAgICAgIHJldHVybiBlcnJvckZpZWxkcy5sZW5ndGggPT0gMDtcclxuICAgIH1cclxuXHJcbiAgICAkKFwiLmZvcm1cIikuc3VibWl0KGUgPT4ge1xyXG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgY29uc3QgZm9ybSA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuICAgICAgICBjb25zdCBuYW1lID0gZm9ybS5maW5kKFwiW25hbWU9J25hbWUnXVwiKTsgIFxyXG4gICAgICAgIGNvbnN0IHBob25lID0gZm9ybS5maW5kKFwiW25hbWU9J3Bob25lJ11cIik7IFxyXG4gICAgICAgIGNvbnN0IGNvbW1lbnQgPSBmb3JtLmZpbmQoXCJbbmFtZT0nY29tbWVudCddXCIpOyBcclxuICAgICAgICBjb25zdCB0byA9IGZvcm0uZmluZChcIltuYW1lPSd0byddXCIpOyBcclxuXHJcbiAgICAgICAgY29uc3QgaXNWYWxpZCA9IHZhbGlkYXRlRmllbGRzKGZvcm0sIFtuYW1lLCBwaG9uZSwgY29tbWVudCwgdG9dKVxyXG5cclxuICAgICAgICBjb25zdCBtb2RhbEZvcm0gPSAkKFwiI21vZGFsLWZvcm1cIik7XHJcbiAgICAgICAgY29uc3QgY29udGVudCA9IG1vZGFsRm9ybS5maW5kKFwiLm1vZGFsLWZvcm1fX2NvbnRlbnRcIik7XHJcblxyXG4gICAgICAgIG1vZGFsRm9ybS5yZW1vdmVDbGFzcyhcImVycm9yLW1vZGFsXCIpO1xyXG5cclxuICAgICAgICBpZihpc1ZhbGlkKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlcXVlc3QgPSAkLmFqYXgoe1xyXG4gICAgICAgICAgICAgICAgdXJsOiBcImh0dHBzOi8vd2ViZGV2LWFwaS5sb2Z0c2Nob29sLmNvbS9zZW5kbWFpbFwiLFxyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiBcInBvc3RcIixcclxuICAgICAgICAgICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgICAgICAgICAgICBuYW1lOiBuYW1lLnZhbCgpLFxyXG4gICAgICAgICAgICAgICAgICAgIHBob25lOiBwaG9uZS52YWwoKSxcclxuICAgICAgICAgICAgICAgICAgICBjb21tZW50OiBjb21tZW50LnZhbCgpLFxyXG4gICAgICAgICAgICAgICAgICAgIHRvOiB0by52YWwoKSxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIFxyXG4gICAgICAgICAgICByZXF1ZXN0LmRvbmUoZGF0YSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb250ZW50LnRleHQoZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgICAgIHJlcXVlc3QuZmFpbChkYXRhID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBkYXRhLnJlc3BvbnNlSlNPTi5tZXNzYWdlO1xyXG4gICAgICAgICAgICAgICAgY29udGVudC50ZXh0KG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgbW9kYWxGb3JtLmFkZENsYXNzKFwiZXJyb3ItbW9kYWxcIik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIFxyXG4gICAgICAgICAgICByZXF1ZXN0LmFsd2F5cygoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAkLmZhbmN5Ym94Lm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgICAgIHNyYzogXCIjbW9kYWwtZm9ybVwiLFxyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiaW5saW5lXCIsXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH0pO1xyXG5cclxuXHJcbiAgICAkKFwiLmFwcC1jbG9zZS1tb2RhbFwiKS5jbGljayhlID0+IHtcclxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICAgICQuZmFuY3lib3guY2xvc2UoKTtcclxuICAgICAgICBmb3JtLnJlc2V0KCk7XHJcbiAgICB9KVxyXG59KSgpIFxyXG4gIiwiKGZ1bmN0aW9uKCkgeyAgICAgICBcclxuICAgIGNvbnN0IHNlY3Rpb25zID0gJChcInNlY3Rpb25cIik7XHJcbiAgICBjb25zdCBkaXNwbGF5ID0gJChcIi5tYWluY29udGVudFwiKTtcclxuICAgIGNvbnN0IHNpZGVNZW51ID0gJChcIi5maXhlZC1tZW51XCIpO1xyXG4gICAgY29uc3QgbWVudUl0ZW1zID0gc2lkZU1lbnUuZmluZChcIi5maXhlZC1tZW51X19pdGVtXCIpO1xyXG5cclxuICAgIGNvbnN0IG1vYmlsZURldGVjdCA9IG5ldyBNb2JpbGVEZXRlY3Qod2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQpO1xyXG4gICAgY29uc3QgaXNNb2JpbGUgPSBtb2JpbGVEZXRlY3QubW9iaWxlKCk7XHJcblxyXG4gICAgbGV0IGluU2Nyb2xsID0gZmFsc2U7XHJcblxyXG4gICAgc2VjdGlvbnMuZmlyc3QoKS5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcclxuXHJcbiAgICBjb25zdCBjb3VudFNlY3Rpb25Qb3NpdGlvbiA9IHNlY3Rpb25FcSA9PiB7XHJcbiAgICAgICAgY29uc3QgcG9zaXRpb24gPSBzZWN0aW9uRXEgKiAtMTAwO1xyXG5cclxuICAgICAgICBpZiAoaXNOYU4ocG9zaXRpb24pKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCLQv9C10YDQtdC00LDQvdC+INC90LUg0LLQtdGA0L3QvtC1INC30L3QsNGH0LXQvdC40LUg0LIgY291bnRTZWN0aW9uUG9zaXRpb25cIik7XHJcbiAgICAgICAgICAgIHJldHVybiAwO1xyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHBvc2l0aW9uO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGNoYW5nZU1lbnVUaGVtZUZvclNlY3Rpb24gPSBzZWN0aW9uRXEgPT4ge1xyXG4gICAgICAgIGNvbnN0IGN1cnJlbnRTZWN0aW9uID0gc2VjdGlvbnMuZXEoc2VjdGlvbkVxKTtcclxuICAgICAgICBjb25zdCBtZW51VGhlbWUgPSBjdXJyZW50U2VjdGlvbi5hdHRyKFwiZGF0YS1zaWRlbWVudS10aGVtZVwiKTtcclxuICAgICAgICBjb25zdCBhY3RpdmVDbGFzcyA9IFwiZml4ZWQtbWVudS0tc2hhZG93ZWRcIjtcclxuXHJcbiAgICAgICAgaWYgKG1lbnVUaGVtZSA9PSBcImJsYWNrXCIpe1xyXG4gICAgICAgICAgICBzaWRlTWVudS5hZGRDbGFzcyhhY3RpdmVDbGFzcyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgc2lkZU1lbnUucmVtb3ZlQ2xhc3MoYWN0aXZlQ2xhc3MpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgcmVzZXRBY3RpdmVDbGFzc0Zvckl0ZW0gPSAoaXRlbXMsIGl0ZW1FcSwgYWN0aXZlQ2xhc3MpID0+IHtcclxuICAgICAgICBpdGVtcy5lcShpdGVtRXEpLmFkZENsYXNzKGFjdGl2ZUNsYXNzKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKGFjdGl2ZUNsYXNzKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBwZXJmb3JtVHJhbnNpdGlvbiA9IHNlY3Rpb25FcSA9PiB7XHJcbiAgICAgICAgaWYoaW5TY3JvbGwpIHJldHVybjtcclxuXHJcbiAgICAgICAgY29uc3QgdHJhbnNpdGlvbk92ZXIgPSAxMDAwO1xyXG4gICAgICAgIGNvbnN0IG1vdXNlSW5lcnRpYU92ZXIgPSAzMDA7XHJcblxyXG4gICAgICAgIGluU2Nyb2xsID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgY29uc3QgcG9zaXRpb24gPSBjb3VudFNlY3Rpb25Qb3NpdGlvbihzZWN0aW9uRXEpO1xyXG5cclxuICAgICAgICBjaGFuZ2VNZW51VGhlbWVGb3JTZWN0aW9uKHNlY3Rpb25FcSk7XHJcblxyXG4gICAgICAgIGRpc3BsYXkuY3NzKHtcclxuICAgICAgICAgICAgdHJhbnNmb3JtOiBgdHJhbnNsYXRlWSgke3Bvc2l0aW9ufSUpYFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXNldEFjdGl2ZUNsYXNzRm9ySXRlbShzZWN0aW9ucywgc2VjdGlvbkVxLCBcImFjdGl2ZVwiKTtcclxuXHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIGluU2Nyb2xsID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHJlc2V0QWN0aXZlQ2xhc3NGb3JJdGVtKG1lbnVJdGVtcywgc2VjdGlvbkVxLCBcImZpeGVkLW1lbnVfX2l0ZW0tLWFjdGl2ZVwiKTtcclxuICAgICAgICB9LCB0cmFuc2l0aW9uT3ZlciArIG1vdXNlSW5lcnRpYU92ZXIpO1xyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCB2aWV3cG9ydFNjcm9sbGVyID0gKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGFjdGl2ZVNlY3Rpb24gPSBzZWN0aW9ucy5maWx0ZXIoXCIuYWN0aXZlXCIpO1xyXG4gICAgICAgIGNvbnN0IG5leHRTZWN0aW9uID0gYWN0aXZlU2VjdGlvbi5uZXh0KCk7XHJcbiAgICAgICAgY29uc3QgcHJldlNlY3Rpb24gPSBhY3RpdmVTZWN0aW9uLnByZXYoKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgbmV4dCgpIHtcclxuICAgICAgICAgICAgICAgIGlmIChuZXh0U2VjdGlvbi5sZW5ndGgpe1xyXG4gICAgICAgICAgICAgICAgICAgIHBlcmZvcm1UcmFuc2l0aW9uKG5leHRTZWN0aW9uLmluZGV4KCkpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHByZXYoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocHJldlNlY3Rpb24ubGVuZ3RoKXtcclxuICAgICAgICAgICAgICAgICAgICBwZXJmb3JtVHJhbnNpdGlvbihwcmV2U2VjdGlvbi5pbmRleCgpKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG5cclxuICAgICQod2luZG93KS5vbihcIndoZWVsXCIsIGUgPT4ge1xyXG4gICAgICAgIGNvbnN0IGRlbHRhWSA9IGUub3JpZ2luYWxFdmVudC5kZWx0YVk7XHJcbiAgICAgICAgY29uc3Qgc2Nyb2xsZXIgPSB2aWV3cG9ydFNjcm9sbGVyKCk7XHJcblxyXG4gICAgICAgIGlmIChkZWx0YVkgPiAwKSB7XHJcbiAgICAgICAgICAgIHNjcm9sbGVyLm5leHQoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChkZWx0YVkgPCAwKSB7XHJcbiAgICAgICAgICAgIHNjcm9sbGVyLnByZXYoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfSk7XHJcblxyXG4gICAgJCh3aW5kb3cpLm9uKFwia2V5ZG93blwiLCBlID0+IHtcclxuICAgICAgICBjb25zdCB0YWdOYW1lID0gZS50YXJnZXQudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgIGNvbnN0IHVzZXJUeXBpbmdJbklucHV0cyA9IHRhZ05hbWUgPT0gXCJpbnB1dFwiIHx8IHRhZ05hbWUgPT0gXCJ0ZXh0YXJlYVwiO1xyXG4gICAgICAgIGNvbnN0IHNjcm9sbGVyID0gdmlld3BvcnRTY3JvbGxlcigpO1xyXG5cclxuICAgICAgICBpZiAodXNlclR5cGluZ0luSW5wdXRzKSByZXR1cm47XHJcblxyXG4gICAgICAgIHN3aXRjaCAoZS5rZXlDb2RlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgMzg6IFxyXG4gICAgICAgICAgICAgICAgc2Nyb2xsZXIucHJldigpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgXHJcbiAgICAgICAgICAgIGNhc2UgNDA6IFxyXG4gICAgICAgICAgICAgICAgc2Nyb2xsZXIubmV4dCgpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgJChcIi53cmFwcGVyXCIpLm9uKFwidG91Y2htb3ZlXCIsIGUgPT4gZS5wcmV2ZW50RGVmYXVsdCgpKTtcclxuXHJcbiAgICAkKFwiW2RhdGEtc2Nyb2xsLXRvXCIpLmNsaWNrKGUgPT4ge1xyXG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgY29uc3QgJHRoaXMgPSAkKGUuY3VycmVudFRhcmdldCk7XHJcbiAgICAgICAgY29uc3QgdGFyZ2V0ID0gJHRoaXMuYXR0cihcImRhdGEtc2Nyb2xsLXRvXCIpO1xyXG4gICAgICAgIGNvbnN0IHJlcVNlY3Rpb24gPSAkKGBbZGF0YS1zZWN0aW9uLWlkPSR7dGFyZ2V0fV1gKTtcclxuXHJcbiAgICAgICAgcGVyZm9ybVRyYW5zaXRpb24ocmVxU2VjdGlvbi5pbmRleCgpKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGlmIChpc01vYmlsZSkge1xyXG4gICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9tYXR0YnJ5c29uL1RvdWNoU3dpcGUtSnF1ZXJ5LVBsdWdpblxyXG5cclxuICAgICAgICAkKFwiYm9keVwiKS5zd2lwZSgge1xyXG4gICAgICAgICAgICBzd2lwZTogZnVuY3Rpb24oZXZlbnQsIGRpcmVjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgc2Nyb2xsZXIgPSB2aWV3cG9ydFNjcm9sbGVyKCk7XHJcbiAgICAgICAgICAgICAgICBsZXQgc2Nyb2xsRGlyZWN0aW9uID0gXCJcIjtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZGlyZWN0aW9uID09IFwidXBcIikgc2Nyb2xsRGlyZWN0aW9uID0gXCJuZXh0XCI7XHJcbiAgICAgICAgICAgICAgICBpZiAoZGlyZWN0aW9uID09IFwiZG93blwiKSBzY3JvbGxEaXJlY3Rpb24gPSBcInByZXZcIjtcclxuXHJcbiAgICAgICAgICAgICAgICBzY3JvbGxlcltzY3JvbGxEaXJlY3Rpb25dKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxufSkoKSAiLCIgIFxyXG4gICAgbGV0IHBsYXllcjtcclxuICAgIGNvbnN0IHBsYXllckNvbnRhaW5lciA9ICQoJy5wbGF5ZXInKTtcclxuXHJcbiAgICBsZXQgZXZlbnRzSW5pdCA9ICgpID0+IHtcclxuICAgICAgICAkKFwiLnBsYXllcl9fc3RhcnRcIikuY2xpY2soIGUgPT4ge1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiAocGxheWVyQ29udGFpbmVyLmhhc0NsYXNzKCdwYXVzZWQnKSkge1xyXG4gICAgICAgICAgICAgICAgcGxheWVyLnBhdXNlVmlkZW8oKVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcGxheWVyLnBsYXlWaWRlbygpO1xyXG4gICAgICAgICAgICB9ICAgICAgICBcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJChcIi5wbGF5ZXJfX3BsYXliYWNrXCIpLmNsaWNrKGUgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBiYXIgPSAkKGUuY3VycmVudFRhcmdldCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGNsaWNrZWRQb3NpdGlvbiA9IChlLm9yaWdpbmFsRXZlbnQubGF5ZXJYKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coY2xpY2tlZFBvc2l0aW9uKTtcclxuICAgICAgICAgICAgY29uc3QgbmV3QnV0dG9uUG9zaXRpb25QZXJjZW50ID0gKGNsaWNrZWRQb3NpdGlvbiAvIGJhci53aWR0aCgpKSAqIDEwMDtcclxuICAgICAgICAgICAgY29uc3QgbmV3UGxheWJhY2tQb3NpdGlvblNlYyA9IChwbGF5ZXIuZ2V0RHVyYXRpb24oKSAvIDEwMCkgKiBuZXdCdXR0b25Qb3NpdGlvblBlcmNlbnQ7XHJcblxyXG4gICAgICAgICAgICAkKFwiLnBsYXllcl9fcGxheWJhY2stYnV0dG9uXCIpLmNzcyh7XHJcbiAgICAgICAgICAgICAgICBsZWZ0OiBgJHtuZXdCdXR0b25Qb3NpdGlvblBlcmNlbnR9JWBcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBwbGF5ZXIuc2Vla1RvKG5ld1BsYXliYWNrUG9zaXRpb25TZWMpO1xyXG5cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJChcIi5wbGF5ZXJfX3NwbGFzaFwiKS5jbGljayhlID0+IHtcclxuICAgICAgICAgICAgcGxheWVyLnBsYXlWaWRlbygpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCBmb3JtYXRUaW1lID0gdGltZVNlYyA9PiB7XHJcbiAgICAgICAgY29uc3Qgcm91bmQgPSBNYXRoLnJvdW5kKHRpbWVTZWMpO1xyXG5cclxuICAgICAgICBjb25zdCBtaW51dGVzID0gTWF0aC5mbG9vcihyb3VuZFRpbWUgLyA2MCk7XHJcbiAgICAgICAgY29uc3Qgc2Vjb25kcyA9IHJvdW5kVGltZSAtIG1pbnV0ZXMgKiA2MDtcclxuXHJcbiAgICAgICAgcmV0dXJuIGAke21pbnV0ZXN9IDogJHtzZWNvbmRzfWA7IFxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IG9uUGxheWVyUmVhZHkgPSAoKSA9PiB7XHJcbiAgICAgICAgbGV0IGludGVydmFsO1xyXG4gICAgICAgIGNvbnN0IGR1cmF0aW9uU2VjID0gcGxheWVyLmdldER1cmF0aW9uKCk7XHJcblxyXG4gICAgICAgIGlmICh0eXBlb2YgaW50ZXJ2YWwgIT0gXCJ1bmRlZmluZWRcIikge1xyXG4gICAgICAgICAgICBjbGVhckludGVydmFsKGludGVydmFsKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBjb21wbGV0ZWRTZWMgPSBwbGF5ZXIuZ2V0Q3VycmVudFRpbWUoKTtcclxuICAgICAgICAgICAgY29uc3QgY29tcGxldGVkUGVyY2VudCA9IChjb21wbGV0ZWRTZWMgLyBkdXJhdGlvblNlYykgKiAxMDA7XHJcblxyXG4gICAgICAgICAgICAkKFwiLnBsYXllcl9fcGxheWJhY2stYnV0dG9uXCIpLmNzcyh7XHJcbiAgICAgICAgICAgICAgICBsZWZ0OiBgJHtjb21wbGV0ZWRQZXJjZW50fSVgXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSwgMTAwMClcclxuXHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgb25QbGF5ZXJTdGF0ZUNoYW5nZSA9IGV2ZW50ID0+IHtcclxuICAgICAgICAvKiBcclxuICAgICAgICAgICAgLTEg4oCTINCy0L7RgdC/0YDQvtC40LfQstC10LTQtdC90LjQtSDQstC40LTQtdC+INC90LUg0L3QsNGH0LDQu9C+0YHRjFxyXG4gICAgICAgICAgICAwIOKAkyDQstC+0YHQv9GA0L7QuNC30LLQtdC00LXQvdC40LUg0LLQuNC00LXQviDQt9Cw0LLQtdGA0YjQtdC90L5cclxuICAgICAgICAgICAgMSDigJMg0LLQvtGB0L/RgNC+0LjQt9Cy0LXQtNC10L3QuNC1XHJcbiAgICAgICAgICAgIDIg4oCTINC/0LDRg9C30LBcclxuICAgICAgICAgICAgMyDigJMg0LHRg9GE0LXRgNC40LfQsNGG0LjRj1xyXG4gICAgICAgICAgICA1IOKAkyDQstC40LTQtdC+INC90LDRhdC+0LTQuNGC0YHRjyDQsiDQvtGH0LXRgNC10LTQuFxyXG4gICAgICAgICovXHJcbiAgICAgICAgc3dpdGNoIChldmVudC5kYXRhKSB7XHJcbiAgICAgICAgICAgIGNhc2UgMTpcclxuICAgICAgICAgICAgICAgIHBsYXllckNvbnRhaW5lci5hZGRDbGFzcygnYWN0aXZlJyk7XHJcbiAgICAgICAgICAgICAgICBwbGF5ZXJDb250YWluZXIuYWRkQ2xhc3MoXCJwYXVzZWRcIik7XHJcbiAgICAgICAgICAgICAgICAkKCcjcGxheScpLmNzcyhcImRpc3BsYXlcIiwgXCJub25lXCIpO1xyXG4gICAgICAgICAgICAgICAgJCgnI3BhdXNlJykuY3NzKFwiZGlzcGxheVwiLCBcImJsb2NrXCIpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIDI6XHJcbiAgICAgICAgICAgICAgICBwbGF5ZXJDb250YWluZXIucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgICAgICAgICAgICAgcGxheWVyQ29udGFpbmVyLnJlbW92ZUNsYXNzKFwicGF1c2VkXCIpO1xyXG4gICAgICAgICAgICAgICAgJCgnI3BhdXNlJykuY3NzKFwiZGlzcGxheVwiLCBcIm5vbmVcIik7XHJcbiAgICAgICAgICAgICAgICAkKCcjcGxheScpLmNzcyhcImRpc3BsYXlcIiwgXCJibG9ja1wiKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgbGV0IGRpbWVuc2lvbnMgPSB7XHJcbiAgICAgICAgaGVpZ2h0OiBcIjM5MFwiLFxyXG4gICAgICAgIHdpZHRoOiBcIjY2MFwiXHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IGlzVGFibGV0cyA9IHdpbmRvdy5tYXRjaE1lZGlhKFwiKG1heC13aWR0aDogNzY4cHgpXCIpLm1hdGNoZXM7XHJcbiAgICBjb25zdCBpc01vYmlsZSA9IHdpbmRvdy5tYXRjaE1lZGlhKFwiKG1heC13aWR0aDogNDgwcHgpXCIpLm1hdGNoZXM7XHJcbiAgICBcclxuICAgIGlmKGlzVGFibGV0cykge1xyXG4gICAgICAgIGRpbWVuc2lvbnMgPSB7XHJcbiAgICAgICAgICAgIGhlaWdodDogXCIzNTFcIixcclxuICAgICAgICAgICAgd2lkdGg6IFwiNTk0XCJcclxuICAgICAgICB9XHJcbiAgICB9IFxyXG4gICAgXHJcbiAgICBpZihpc01vYmlsZSkge1xyXG4gICAgICAgIGRpbWVuc2lvbnMgPSB7XHJcbiAgICAgICAgICAgIGhlaWdodDogXCIyMzNcIixcclxuICAgICAgICAgICAgd2lkdGg6IFwiMzk0XCJcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gb25Zb3VUdWJlSWZyYW1lQVBJUmVhZHkoKSB7XHJcbiAgICAgICAgcGxheWVyID0gbmV3IFlULlBsYXllcigneXQtcGxheWVyJywge1xyXG4gICAgICAgICAgICAuLi5kaW1lbnNpb25zLFxyXG4gICAgICAgICAgICB2aWRlb0lkOiAnTFhiM0VLV3NJblEnLFxyXG4gICAgICAgICAgICBldmVudHM6IHtcclxuICAgICAgICAgICAgICAgICdvblJlYWR5Jzogb25QbGF5ZXJSZWFkeSxcclxuICAgICAgICAgICAgICAgICdvblN0YXRlQ2hhbmdlJzogb25QbGF5ZXJTdGF0ZUNoYW5nZVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBwbGF5ZXJWYXJzOiB7XHJcbiAgICAgICAgICAgICAgICBjb250cm9sczogMCxcclxuICAgICAgICAgICAgICAgIGRpc2FibGVrYjogMCxcclxuICAgICAgICAgICAgICAgIHNob3dJbmZvOiAwLFxyXG4gICAgICAgICAgICAgICAgcmVsOiAwLFxyXG4gICAgICAgICAgICAgICAgYXV0b3BsYXk6IDAsXHJcbiAgICAgICAgICAgICAgICBtb2Rlc3RicmFuZGluZzogMCxcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGV2ZW50c0luaXQoKTtcclxuICAgICAgICBcclxuICAgIGxldCBzb3VuZENvbnRyb2w7XHJcbiAgICBsZXQgc291bmRMZXZlbDtcclxuXHJcbiAgICAkKCkucmVhZHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGluaXRWYXJzKCk7XHJcbiAgICAgICAgc291bmRDb250cm9sLm1pbiA9IDA7XHJcbiAgICAgICAgc291bmRDb250cm9sLm1heCA9IDEwMDtcclxuICAgICAgICBzb3VuZENvbnRyb2wudmFsdWUgPSBzb3VuZENvbnRyb2wubWF4O1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8g0LjQvdC40YbQuNCw0LvQuNC30LDRhtC40Y8g0L/QtdGA0LzQtdC90L3Ri9GFXHJcbiAgICBmdW5jdGlvbiBpbml0VmFycygpIHtcclxuICAgICAgICBwbGF5ZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgneXQtcGxheWVyJyk7XHJcbiAgICAgICAgc291bmRDb250cm9sID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21pY0xldmVsJyk7XHJcbiAgICB9XHJcblxyXG4gICAgJCgnI21pYycpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkgeyAgICAgIFxyXG4gICAgICAgIGlmKHBsYXllci5pc011dGVkKCkpe1xyXG4gICAgICAgICAgICBzb3VuZENvbnRyb2wudmFsdWUgPSBzb3VuZExldmVsICogMTAwO1xyXG4gICAgICAgICAgICBwbGF5ZXIudW5NdXRlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIGVsc2V7XHJcbiAgICAgICAgICAgIHNvdW5kQ29udHJvbC52YWx1ZSA9IDA7XHJcbiAgICAgICAgICAgIHBsYXllci5tdXRlKCk7XHJcbiAgICAgICAgfSAgICBcclxuICAgIH0pO1xyXG5cclxuICAgICQoJyNtaWNMZXZlbCcpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcGxheWVyLnNldFZvbHVtZSgkKHRoaXMpLnZhbCgpKTtcclxuICAgIH0pO1xyXG4gICAgICAgICAgICAiLCIkKCcuc2xpZGVyX19saXN0JykuYnhTbGlkZXIoe1xyXG4gICAgICAgIFxyXG59KTtcclxuIiwiKGZ1bmN0aW9uKCkgeyAgICAgICBcclxuICAgIGNvbnN0IGZpbmRCbG9ja0J5QWxpYXMgPSAoYWxpYXMpID0+IHtcclxuICAgICAgICByZXR1cm4gJChcIi5yZXZpZXdzX19pdGVtXCIpLmZpbHRlcigobmR4LCBpdGVtKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiAkKGl0ZW0pLmF0dHIoXCJkYXRhLWxpbmtlZC13aXRoXCIpID09IGFsaWFzO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICAkKFwiLmludGVyYWN0aXZlLWF2YXRhcl9fbGlua1wiKS5jbGljaygoZSkgPT4ge1xyXG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgY29uc3QgJHRoaXMgPSAkKGUuY3VycmVudFRhcmdldCk7XHJcbiAgICAgICAgY29uc3QgdGFyZ2V0ID0gJHRoaXMuYXR0cihcImRhdGEtb3BlblwiKTtcclxuICAgICAgICBjb25zdCBpdGVtVG9TaG93ID0gZmluZEJsb2NrQnlBbGlhcyh0YXJnZXQpO1xyXG4gICAgICAgIGNvbnN0IGN1ckl0ZW0gPSAkdGhpcy5jbG9zZXN0KFwiLmludGVyYWN0aXZlLWF2YXRhclwiKTtcclxuXHJcbiAgICAgICAgaXRlbVRvU2hvdy5hZGRDbGFzcyhcImFjdGl2ZVwiKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xyXG4gICAgICAgIGN1ckl0ZW0uYWRkQ2xhc3MoXCJhY3RpdmVcIikuc2libGluZ3MoKS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcclxuICAgIH0pO1xyXG59KSgpICJdfQ==
